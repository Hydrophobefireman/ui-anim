import{createContext as t,useMemo as e,useEffect as n,createElement as r,useRef as s,useContext as i,useState as a,useLayoutEffect as o}from"./@hydrophobefireman/ui-lib.js";function l(){return(l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}const c={};function u({from:t,to:e,callback:n,steps:r}){const s={cancelled:!1};return m(t,e,(e-t)/r,n,s,function(){s.cancelled=!0})}function h(t,e,n){return-n*t+n*e+t}function m(t,e,n,r,s,i){return s.cancelled?r(c,i):(n>0?t>=e:t<=e)?r(e,i):(requestAnimationFrame(()=>m(t+n,e,n,r,s,i)),void r(t,i))}const d="freeze"in Object?Object.freeze:function(t){return t},f=document.documentElement;function p(t,e,n){return e?0:t}const g=t(null);class y{constructor(){this._snapshots=new Map,this._snapshotToDomMap=new WeakMap}getSnapshot(t){return this._snapshots.get(t)}measure(t,e){const n=function(t){t.style.transform="";const e=t.getBoundingClientRect(),n=f.getBoundingClientRect(),{height:r,width:s,x:i,y:a,left:o,right:l,top:c,bottom:u}=e,{offsetHeight:m,offsetWidth:p}=f;return d({height:r,width:s,x:i-n.left,y:a-n.top,originPoints:{x:h(o-n.left,l-(n.right-p),.5),y:h(c-n.top,u-(n.bottom-m),.5)}})}(e);return this._snapshots.set(t,n),this._snapshotToDomMap.set(n,e),n}measureAll(){this._snapshots.forEach((t,e)=>{const n=this._snapshotToDomMap.get(t);n&&this.measure(e,n)})}}function _({children:t}){const s=e(()=>new y,[]);return n(()=>{const t=()=>s.measureAll();return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),r(g.Provider,{value:s,children:t})}const w=t(null);class x{constructor(){this.children=new Set,this._isAnimating=!1,this._cancelled=!1,this._config={id:null,isRoot:null,time:null,wrappedDomNode:null,parent:null}}_reset(){this.cancel(),this._isAnimating=!1}isReady(){return!!this._motionManager}isAnimating(){return this._isAnimating}isCancelled(){return this._cancelled}cancel(){return this._cancelled=!0,this._isAnimating=!1,this}setManager(t){return this._motionManager=t,this}unmount(){return this._motionManager=this._config=null,this}getSnapshot(){return this._motionManager.getSnapshot(this._config.id)}attach(t){return this.children.add(t),this}detach(t){return this.children.delete(t),this}measure(){return this._motionManager.measure(this._config.id,this._config.wrappedDomNode)}safeRequestLayout({nextFrame:t}){return new Promise(e=>{const n=()=>{if(this.isReady())return this.requestLayout().then(()=>e(null));e(null)};return t?requestAnimationFrame(n):n(),this})}requestLayout(t={x:1,y:1},e){this._reset();const n=this.getSnapshot(),r=this.measure();if(!n)return Promise.resolve(null);const s=function(t,e){const{originPoints:n,width:r,height:s}=e,{originPoints:i,width:a,height:o}=t;return{currWidth:a,currHeight:o,x:{translate:n.x-i.x,scale:r/a},y:{translate:n.y-i.y,scale:s/o}}}(r,n),i={x:s.x.scale,y:s.y.scale};return this.children.forEach(t=>t.requestLayout(i,s)),this.animateTreeDelta(s,t,e)}animateTreeDelta(t,e={x:1,y:1},n){return this._isAnimating=!0,this._cancelled=!1,function({el:t,nodeInstance:e,time:n=300,translateDelta:r,treeScale:s,parentDelta:i}){const a=t.style.transition;return t.style.transition="0s",new Promise(a=>{const{x:o,y:l}=r;if(1===o.scale&&0===o.translate&&1===l.scale&&0===l.translate&&1===s.x&&1===s.y)return a(null);u({from:0,to:1,callback(n,r){if(n===c)return a(null);const u=l.scale/s.y,m={scaleX:h(o.scale/s.x,1,n),scaleY:h(u,1,n),translateX:h(p(o.translate,i&&i.x.translate),0,n),translateY:h(p(l.translate,i&&i.y.translate),0,n)};!function(t,e){t.style.transform=`\n  translateX(${e.translateX}px) \n  translateY(${e.translateY}px) \n  scaleX(${e.scaleX}) \n  scaleY(${e.scaleY})`}(t,m),1===n&&a(null),e.isCancelled()&&r()},steps:n/16})}).then(()=>(requestAnimationFrame(()=>t.style.transition=a),null))}({el:this._config.wrappedDomNode,translateDelta:t,time:this._config.time||300,nodeInstance:this,treeScale:e,parentDelta:n}).then(t=>{this._isAnimating=!1})}setTreeState({wrappedDomNode:t,time:e,id:n,parent:r}){return this._config={wrappedDomNode:t,time:e,id:n,isRoot:null==r,parent:r},this}}function D(t){const{element:e,animId:c,time:u}=t,h=function(t,e){if(null==t)return{};var n,r,s={},i=Object.keys(t);for(r=0;r<i.length;r++)e.indexOf(n=i[r])>=0||(s[n]=t[n]);return s}(t,["element","animId","time"]),m=s(),d=s(),f=i(g),p=i(w),y=d.current,[,_]=a(null);return o(()=>{const t=d.current||(d.current=new x);if(p&&p.attach(t),t.setManager(f),!m.current)return;const e={};return t.setTreeState({id:c,wrappedDomNode:m.current,parent:p,time:u}).getSnapshot()||_(e),t.safeRequestLayout(e),()=>{p&&p.detach(t),t.unmount()}},[m.current,c,u,p,f]),o(()=>{m.current&&y&&function(t){return!t||!t.isAnimating()}(p)&&y.safeRequestLayout({})}),n(()=>()=>y&&y.cancel().unmount(),[y]),r(w.Provider,{value:y},r(e,l({ref:m},h)))}export{D as AnimateLayout,_ as Motion};
//# sourceMappingURL=ui-anim.modern.js.map
