import{createContext as t,useMemo as e,useState as n,useEffect as s,createElement as r,useRef as i,useContext as a,useLayoutEffect as o}from"./@hydrophobefireman/ui-lib.js";function l(){return(l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t}).apply(this,arguments)}const u={};function c({from:t,to:e,callback:n,steps:s}){const r={cancelled:!1};return m(t,e,(e-t)/s,n,r,function(){r.cancelled=!0})}function h(t,e,n){return-n*t+n*e+t}function m(t,e,n,s,r,i){return r.cancelled?s(u,i):(n>0?t>=e:t<=e)?s(e,i):(requestAnimationFrame(()=>m(t+n,e,n,s,r,i)),void s(t,i))}const d="freeze"in Object?Object.freeze:function(t){return t};class p{constructor(t){this.snap=t}}function f(t,e){return null==t?t:_(t,t=>e*(t/100))}function g(t,e){return null==t?t:_(t,t=>e+e*(t/100))}function _(t,e){if("number"==typeof t)return t;const n=t.length-1;if("%"===(t=t.trim())[n]){const s=t.substr(0,n);return e(parseFloat(s))}return+t}const y=document.documentElement;function w(t,e,n){return e?0:t}function x({height:t,width:e,originX:n,originY:s}){const{innerWidth:r,innerHeight:i}=window,a=f(t,i),o=f(e,r),l=g(n,r/2),u=g(s,i/2);return d({height:a,width:o,originPoints:{x:l,y:u}})}const v=t(null);class S{constructor(){this._snapshots=new Map,this._snapshotToDomMap=new WeakMap}getSnapshot(t){return this._snapshots.get(t)}setFps(t){this.fps=t}unmount(){this._snapshots.clear()}overrideSnapshot(t,e,n){return this._setSnapshot(t,e,n)}_setSnapshot(t,e,n){return this._snapshots.set(t,n),this._snapshotToDomMap.set(n,e),n}measure(t,e){const n=function(t){t.style.transform="";const e=t.getBoundingClientRect(),n=y.getBoundingClientRect(),{height:s,width:r,left:i,right:a,top:o,bottom:l}=e,{offsetHeight:u,offsetWidth:c}=y;return d({height:s,width:r,originPoints:{x:h(i-n.left,a-(n.right-c),.5),y:h(o-n.top,l-(n.bottom-u),.5)}})}(e);return this._setSnapshot(t,e,n)}measureAll(){this._snapshots.forEach((t,e)=>{const n=this._snapshotToDomMap.get(t);if(n)return n&&!n.isConnected?(this._snapshots.delete(e),void this._snapshotToDomMap.delete(t)):void this.measure(e,n)})}}function D({children:t}){const i=e(()=>new S,[]),[a,o]=n(null);return s(()=>{Promise.race([new Promise(t=>requestAnimationFrame(e=>requestAnimationFrame(n=>t(Math.max(1e3/(n-e),60))))),new Promise(t=>setTimeout(()=>t(60),1e3))]).then(t=>o(t))},[]),i.setFps(a),s(()=>{const t=()=>i.measureAll();return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t),i.unmount()}},[]),null==a?null:r(v.Provider,{value:i,children:t})}const M=t(null);class A{constructor(){this.children=new Set,this._isAnimating=!1,this._cancelled=!1,this._config={id:null,isRoot:null,time:null,wrappedDomNode:null,parent:null}}_reset(){this.cancel(),this._isAnimating=!1}isReady(){return!!this._motionManager}isAnimating(){return this._isAnimating}isCancelled(){return this._cancelled}cancel(){return this._cancelled=!0,this._isAnimating=!1,this}setManager(t){return this._motionManager=t,this}unmount(){return this._motionManager=this._config=null,this}overrideSnapshot(t){this._motionManager.overrideSnapshot(this._config.id,this._config.wrappedDomNode,t)}getSnapshot(){return this._motionManager.getSnapshot(this._config.id)}attach(t){return this.children.add(t),this}detach(t){return this.children.delete(t),this}measure(){return this._motionManager.measure(this._config.id,this._config.wrappedDomNode)}safeRequestLayout({nextFrame:t}){return new Promise(e=>{const n=()=>{if(this.isReady())return this.requestLayout().then(()=>e(null));e(null)};return t?requestAnimationFrame(n):n(),this})}requestLayout(t={x:1,y:1},e){this._reset();const n=this.getSnapshot(),s=this.measure();if(!n)return Promise.resolve(null);const r=function(t,e){const{originPoints:n,width:s,height:r}=t;if(e instanceof p){const{snap:t}=e,{scaleX:n,scaleY:s,translateX:r,translateY:i}=t;return{x:{translate:null==r?0:r,scale:null==n?1:n},y:{translate:null==i?0:i,scale:null==s?1:s}}}const{originPoints:i,width:a,height:o}=e;return{x:{translate:null==i.x?0:i.x-n.x,scale:null==a?1:a/s},y:{translate:null==i.y?0:i.y-n.y,scale:null==o?1:o/r}}}(s,n),i={x:r.x.scale,y:r.y.scale};return this.children.forEach(t=>t.requestLayout(i,r)),this.animateTreeDelta(r,t,e)}animateTreeDelta(t,e={x:1,y:1},n){return this._isAnimating=!0,this._cancelled=!1,function({el:t,nodeInstance:e,time:n=300,translateDelta:s,treeScale:r,parentDelta:i,fps:a=60}){const o=t.style.transition;return t.style.transition="0s",new Promise(o=>{const{x:l,y:m}=s;if(1===l.scale&&0===l.translate&&1===m.scale&&0===m.translate&&1===r.x&&1===r.y)return o(null);c({from:0,to:1,callback(n,s){if(n===u)return o(null);if(1===n)return t.style.transform="",o(null);const a=m.scale/r.y,c={scaleX:h(l.scale/r.x,1,n),scaleY:h(a,1,n),translateX:h(w(l.translate,i&&i.x.translate),0,n),translateY:h(w(m.translate,i&&i.y.translate),0,n)};!function(t,e){t.style.transform=`\n  translateX(${e.translateX}px) \n  translateY(${e.translateY}px) \n  scaleX(${e.scaleX}) \n  scaleY(${e.scaleY})`}(t,c),e.isCancelled()&&s()},steps:n/(1/a*1e3)})}).then(()=>(requestAnimationFrame(()=>t.style.transition=o),null))}({el:this._config.wrappedDomNode,translateDelta:t,time:this._config.time||300,nodeInstance:this,treeScale:e,parentDelta:n,fps:this._motionManager.fps}).then(t=>{this._isAnimating=!1})}setTreeState({wrappedDomNode:t,time:e,id:n,parent:s}){return this._config={wrappedDomNode:t,time:e,id:n,isRoot:null==s,parent:s},this}}function b(t){const{element:e,animId:u,time:c,initialSnapshot:h,onlyInitial:m}=t,d=function(t,e){if(null==t)return{};var n,s,r={},i=Object.keys(t);for(s=0;s<i.length;s++)e.indexOf(n=i[s])>=0||(r[n]=t[n]);return r}(t,["element","animId","time","initialSnapshot","onlyInitial"]),p=i(),f=i(),g=i(!1),_=a(v),y=a(M),w=f.current,[,x]=n(null);return o(()=>{const t=f.current||(f.current=new A);if(y&&y.attach(t),t.setManager(_),!p.current)return;t.setTreeState({id:u,wrappedDomNode:p.current,parent:y,time:c});const e={};return g.current||(h&&t.overrideSnapshot(h),x(e)),g.current=!0,t.safeRequestLayout(e),()=>{y&&y.detach(t),t.unmount()}},[p.current,u,c,y,_,h]),o(()=>{!m&&p.current&&w&&function(t){return!t||!t.isAnimating()}(y)&&w.safeRequestLayout({})}),s(()=>()=>w&&w.cancel().unmount(),[w]),r(M.Provider,{value:w},r(e,l({ref:p},d)))}export{b as AnimateLayout,p as DeclarativeTransform,D as Motion,c as animate,x as createSnapshot,h as interpolate};
//# sourceMappingURL=ui-anim.modern.js.map
