import{createContext as t,useMemo as e,useState as n,useEffect as r,createElement as i,useRef as s,useContext as a,useLayoutEffect as o}from"./@hydrophobefireman/ui-lib.js";function l(){return(l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}const u={};function c({from:t,to:e,callback:n,steps:r}){const i={cancelled:!1};return m(t,e,(e-t)/r,n,i,function(){i.cancelled=!0})}function h(t,e,n){return-n*t+n*e+t}function m(t,e,n,r,i,s){return i.cancelled?r(u,s):(n>0?t>=e:t<=e)?r(e,s):(requestAnimationFrame(()=>m(t+n,e,n,r,i,s)),void r(t,s))}const d="freeze"in Object?Object.freeze:function(t){return t},p=document.documentElement;function f(t,e,n){return e?0:t}function g({height:t,width:e,originX:n,originY:r}){const{innerWidth:i,innerHeight:s}=window,a=_(t,s),o=_(e,i),l=y(n,i/2),u=y(r,s/2);return d({height:a,width:o,originPoints:{x:l,y:u}})}function _(t,e){return w(t,t=>e*(t/100))}function y(t,e){return w(t,t=>e+e*(t/100))}function w(t,e){if("number"==typeof t)return t;const n=t.length-1;if("%"===(t=t.trim())[n]){const r=t.substr(0,n);return e(parseFloat(r))}return+t}const v=t(null);class x{constructor(){this._snapshots=new Map,this._snapshotToDomMap=new WeakMap}getSnapshot(t){return this._snapshots.get(t)}setFps(t){this.fps=t}unmount(){this._snapshots.clear()}overrideSnapshot(t,e,n){return this._setSnapshot(t,e,n)}_setSnapshot(t,e,n){return this._snapshots.set(t,n),this._snapshotToDomMap.set(n,e),n}measure(t,e){const n=function(t){t.style.transform="";const e=t.getBoundingClientRect(),n=p.getBoundingClientRect(),{height:r,width:i,left:s,right:a,top:o,bottom:l}=e,{offsetHeight:u,offsetWidth:c}=p;return d({height:r,width:i,originPoints:{x:h(s-n.left,a-(n.right-c),.5),y:h(o-n.top,l-(n.bottom-u),.5)}})}(e);return this._setSnapshot(t,e,n)}measureAll(){this._snapshots.forEach((t,e)=>{const n=this._snapshotToDomMap.get(t);if(n)return n&&!n.isConnected?(this._snapshots.delete(e),void this._snapshotToDomMap.delete(t)):void this.measure(e,n)})}}function S({children:t}){const s=e(()=>new x,[]),[a,o]=n(null);return r(()=>{Promise.race([new Promise(t=>requestAnimationFrame(e=>requestAnimationFrame(n=>t(1e3/(n-e))))),new Promise(t=>setTimeout(()=>t(60),1e3))]).then(t=>o(t))},[]),s.setFps(a),r(()=>{const t=()=>s.measureAll();return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t),s.unmount()}},[]),null==a?null:i(v.Provider,{value:s,children:t})}const D=t(null);class A{constructor(){this.children=new Set,this._isAnimating=!1,this._cancelled=!1,this._config={id:null,isRoot:null,time:null,wrappedDomNode:null,parent:null}}_reset(){this.cancel(),this._isAnimating=!1}isReady(){return!!this._motionManager}isAnimating(){return this._isAnimating}isCancelled(){return this._cancelled}cancel(){return this._cancelled=!0,this._isAnimating=!1,this}setManager(t){return this._motionManager=t,this}unmount(){return this._motionManager=this._config=null,this}overrideSnapshot(t){this._motionManager.overrideSnapshot(this._config.id,this._config.wrappedDomNode,t)}getSnapshot(){return this._motionManager.getSnapshot(this._config.id)}attach(t){return this.children.add(t),this}detach(t){return this.children.delete(t),this}measure(){return this._motionManager.measure(this._config.id,this._config.wrappedDomNode)}safeRequestLayout({nextFrame:t}){return new Promise(e=>{const n=()=>{if(this.isReady())return this.requestLayout().then(()=>e(null));e(null)};return t?requestAnimationFrame(n):n(),this})}requestLayout(t={x:1,y:1},e){this._reset();const n=this.getSnapshot(),r=this.measure();if(!n)return Promise.resolve(null);const i=function(t,e){const{originPoints:n,width:r,height:i}=e,{originPoints:s,width:a,height:o}=t;return{currWidth:a,currHeight:o,x:{translate:n.x-s.x,scale:r/a},y:{translate:n.y-s.y,scale:i/o}}}(r,n),s={x:i.x.scale,y:i.y.scale};return this.children.forEach(t=>t.requestLayout(s,i)),this.animateTreeDelta(i,t,e)}animateTreeDelta(t,e={x:1,y:1},n){return this._isAnimating=!0,this._cancelled=!1,function({el:t,nodeInstance:e,time:n=300,translateDelta:r,treeScale:i,parentDelta:s,fps:a=60}){const o=t.style.transition;return t.style.transition="0s",new Promise(o=>{const{x:l,y:m}=r;if(1===l.scale&&0===l.translate&&1===m.scale&&0===m.translate&&1===i.x&&1===i.y)return o(null);c({from:0,to:1,callback(n,r){if(n===u)return o(null);const a=m.scale/i.y,c={scaleX:h(l.scale/i.x,1,n),scaleY:h(a,1,n),translateX:h(f(l.translate,s&&s.x.translate),0,n),translateY:h(f(m.translate,s&&s.y.translate),0,n)};!function(t,e){t.style.transform=`\n  translateX(${e.translateX}px) \n  translateY(${e.translateY}px) \n  scaleX(${e.scaleX}) \n  scaleY(${e.scaleY})`}(t,c),1===n&&o(null),e.isCancelled()&&r()},steps:n/(1/a*1e3)})}).then(()=>(requestAnimationFrame(()=>t.style.transition=o),null))}({el:this._config.wrappedDomNode,translateDelta:t,time:this._config.time||300,nodeInstance:this,treeScale:e,parentDelta:n,fps:this._motionManager.fps}).then(t=>{this._isAnimating=!1})}setTreeState({wrappedDomNode:t,time:e,id:n,parent:r}){return this._config={wrappedDomNode:t,time:e,id:n,isRoot:null==r,parent:r},this}}function M(t){const{element:e,animId:u,time:c,initialSnapshot:h}=t,m=function(t,e){if(null==t)return{};var n,r,i={},s=Object.keys(t);for(r=0;r<s.length;r++)e.indexOf(n=s[r])>=0||(i[n]=t[n]);return i}(t,["element","animId","time","initialSnapshot"]),d=s(),p=s(),f=s(!1),g=a(v),_=a(D),y=p.current,[,w]=n(null);return o(()=>{const t=p.current||(p.current=new A);if(_&&_.attach(t),t.setManager(g),!d.current)return;t.setTreeState({id:u,wrappedDomNode:d.current,parent:_,time:c});const e={};return f.current||(h&&t.overrideSnapshot(h),w(e)),f.current=!0,t.safeRequestLayout(e),()=>{_&&_.detach(t),t.unmount()}},[d.current,u,c,_,g,h]),o(()=>{d.current&&y&&function(t){return!t||!t.isAnimating()}(_)&&y.safeRequestLayout({})}),r(()=>()=>y&&y.cancel().unmount(),[y]),i(D.Provider,{value:y},i(e,l({ref:d},m)))}export{M as AnimateLayout,S as Motion,c as animate,g as createSnapshot,h as interpolate};
//# sourceMappingURL=ui-anim.modern.js.map
