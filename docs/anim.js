import{createContext as t,useMemo as e,useState as n,useEffect as s,createElement as i,useRef as r,useContext as a,useLayoutEffect as o}from"./@hydrophobefireman/ui-lib.js";function l(){return(l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t}).apply(this,arguments)}const u={};function c({from:t,to:e,callback:n,steps:s}){const i={cancelled:!1};return m(t,e,(e-t)/s,n,i,function(){i.cancelled=!0})}function h(t,e,n){return-n*t+n*e+t}function m(t,e,n,s,i,r){return i.cancelled?s(u,r):(n>0?t>=e:t<=e)?s(e,r):(requestAnimationFrame(()=>m(t+n,e,n,s,i,r)),void s(t,r))}function d(t,e){return null==t?t:p(t,t=>e*(t/100))}function f(t,e){return null==t?t:p(t,t=>e+e*(t/100))}function p(t,e){if("number"==typeof t)return t;const n=t.length-1;if("%"===(t=t.trim())[n]){const s=t.substr(0,n);return e(parseFloat(s))}return+t}class g{constructor(t){this.snap=t}}const y="freeze"in Object?Object.freeze:function(t){return t},_=document.documentElement;function w(t,e,n){return e?0:t}function A({height:t,width:e,originX:n,originY:s}){const{innerWidth:i,innerHeight:r}=window,a=d(t,r),o=d(e,i),l=f(n,i/2),u=f(s,r/2);return y({height:a,width:o,originPoints:{x:l,y:u}})}const x=t(null);class v{constructor(){this.children=new Set,this._isAnimating=!1,this._cancelled=!1,this._config={id:null,isRoot:null,time:null,wrappedDomNode:null,parent:null}}_reset(){this.cancel(),this._isAnimating=!1}isReady(){return!!this._motionManager}isAnimating(){return this._isAnimating}isCancelled(){return this._cancelled}cancel(){return this._cancelled=!0,this._isAnimating=!1,this}setManager(t){return this._motionManager=t,this}unmount(){return this._motionManager=this._config=null,this}overrideSnapshot(t){this._motionManager.overrideSnapshot(this._config.id,this._config.wrappedDomNode,t)}getSnapshot(){return this._motionManager.getSnapshot(this._config.id)}attach(t){return this.children.add(t),this}detach(t){return this.children.delete(t),this}measure(){return this._motionManager.measure(this._config.id,this._config.wrappedDomNode)}safeRequestLayout({nextFrame:t}){return new Promise(e=>{const n=()=>{if(this.isReady())return this.requestLayout().then(()=>e(null));e(null)};return t?requestAnimationFrame(n):n(),this})}requestLayout(t={x:1,y:1},e){this._reset();const n=this.getSnapshot(),s=this.measure();if(!n)return Promise.resolve(null);const i=function(t,e){const{originPoints:n,width:s,height:i}=t;if(e instanceof g){const{snap:t}=e,{scaleX:n,scaleY:s,translateX:i,translateY:r}=t;return{x:{translate:null==i?0:i,scale:null==n?1:n},y:{translate:null==r?0:r,scale:null==s?1:s}}}const{originPoints:r,width:a,height:o}=e;return{x:{translate:null==r.x?0:r.x-n.x,scale:null==a?1:a/s},y:{translate:null==r.y?0:r.y-n.y,scale:null==o?1:o/i}}}(s,n),r={x:i.x.scale,y:i.y.scale};return this.children.forEach(t=>t.requestLayout(r,i)),this.animateTreeDelta(i,t,e)}animateTreeDelta(t,e={x:1,y:1},n){return this._isAnimating=!0,this._cancelled=!1,function({el:t,nodeInstance:e,time:n=300,translateDelta:s,treeScale:i,parentDelta:r,fps:a=60,onlyAnimate:o}){const l=t.style.transition;return t.style.transition="0s",new Promise(l=>{const{x:m,y:d}=s;if(1===m.scale&&0===m.translate&&1===d.scale&&0===d.translate&&1===i.x&&1===i.y)return l(null);const f=function(t){return function(e,n,s){return null==t||t[e]?n:s}}(o),p=f("scaleX",m.scale/i.x,1),g=f("scaleY",d.scale/i.y,1),y=f("translateX",w(m.translate,r&&r.x.translate),0),_=f("translateY",w(d.translate,r&&r.y.translate),0);c({from:0,to:1,callback(n,s){if(n===u)return l(null);if(1===n)return t.style.transform="",l(null);const i={scaleX:h(p,1,n),scaleY:h(g,1,n),translateX:h(y,0,n),translateY:h(_,0,n)};!function(t,e){t.style.transform=`\n  translateX(${e.translateX}px) \n  translateY(${e.translateY}px) \n  scaleX(${e.scaleX}) \n  scaleY(${e.scaleY})`}(t,i),e.isCancelled()&&s()},steps:n/(1/a*1e3)})}).then(()=>(requestAnimationFrame(()=>t.style.transition=l),null))}({el:this._config.wrappedDomNode,translateDelta:t,time:this._config.time||300,nodeInstance:this,treeScale:e,parentDelta:n,fps:this._motionManager.fps,onlyAnimate:this._config.onlyAnimate}).then(t=>{this._isAnimating=!1})}setTreeState({wrappedDomNode:t,time:e,onlyAnimate:n,id:s,parent:i}){return this._config={wrappedDomNode:t,time:e,id:s,isRoot:null==i,parent:i,onlyAnimate:n},this}}const S=t(null);class D{constructor(){this._snapshots=new Map,this._snapshotToDomMap=new WeakMap}getSnapshot(t){return this._snapshots.get(t)}setFps(t){this.fps=t}unmount(){this._snapshots.clear()}overrideSnapshot(t,e,n){return this._setSnapshot(t,e,n)}_setSnapshot(t,e,n){return this._snapshots.set(t,n),this._snapshotToDomMap.set(n,e),n}measure(t,e){const n=function(t){t.style.transform="";const e=t.getBoundingClientRect(),n=_.getBoundingClientRect(),{height:s,width:i,left:r,right:a,top:o,bottom:l}=e,{offsetHeight:u,offsetWidth:c}=_;return y({height:s,width:i,originPoints:{x:h(r-n.left,a-(n.right-c),.5),y:h(o-n.top,l-(n.bottom-u),.5)}})}(e);return this._setSnapshot(t,e,n)}measureAll(){this._snapshots.forEach((t,e)=>{const n=this._snapshotToDomMap.get(t);if(n)return n&&!n.isConnected?(this._snapshots.delete(e),void this._snapshotToDomMap.delete(t)):void this.measure(e,n)})}}function M({children:t}){const r=e(()=>new D,[]),[a,o]=n(null);return s(()=>{Promise.race([new Promise(t=>requestAnimationFrame(e=>requestAnimationFrame(n=>t(Math.max(1e3/(n-e),60))))),new Promise(t=>setTimeout(()=>t(60),1e3))]).then(t=>o(t))},[]),r.setFps(a),s(()=>{const t=()=>r.measureAll();return window.addEventListener("resize",t,{passive:!0}),()=>{window.removeEventListener("resize",t),r.unmount()}},[]),null==a?null:i(S.Provider,{value:r,children:t})}function b(t){const{element:e,animId:u,time:c,initialSnapshot:h,onlyInitial:m,onlyAnimate:d}=t,f=function(t,e){if(null==t)return{};var n,s,i={},r=Object.keys(t);for(s=0;s<r.length;s++)e.indexOf(n=r[s])>=0||(i[n]=t[n]);return i}(t,["element","animId","time","initialSnapshot","onlyInitial","onlyAnimate"]),p=r(),g=r(),y=r(!1),_=a(S),w=a(x),A=g.current,[,D]=n(null);return o(()=>{const t=g.current||(g.current=new v);if(w&&w.attach(t),t.setManager(_),!p.current)return;t.setTreeState({id:u,wrappedDomNode:p.current,parent:w,time:c,onlyAnimate:d});const e={};return y.current||(h&&t.overrideSnapshot(h),D(e)),y.current=!0,t.safeRequestLayout(e),()=>{w&&w.detach(t),t.unmount()}},[p.current,u,c,w,_,h,d]),o(()=>{!m&&p.current&&A&&function(t){return!t||!t.isAnimating()}(w)&&A.safeRequestLayout({})}),s(()=>()=>A&&A.cancel().unmount(),[A]),i(x.Provider,{value:A},i(e,l({ref:p},f)))}export{b as AnimateLayout,g as DeclarativeTransform,M as Motion,c as animate,A as createSnapshot,h as interpolate};
//# sourceMappingURL=ui-anim.modern.js.map
